- unless defined?(level)
  - level = 0
- categories.each do |category|
  %li
    = link_to category.name, '#'
    - unless category.children.empty?
      %ul
        - category.children.each do |child|
          = render :partial => 'admin/blocks/associated_pages', :locals => { :categories => [child], :level => (level + 1), :block => block, :element_id => element_id }
        - category.pages.each do |_page|
          %li{ :type => 'folder'}
            = link_to _page.title, '#'
            %ul
              - _page.page_cols.each_with_index do |page_col, index|
                - checked = block.page_cols.include?(page_col)
                %li{:id => "page_col_#{page_col.id}", :class => checked ? 'jstree-checked' : 'jstree-unchecked' }
                  = link_to t("page_col_#{index}"), '#'
                  - if checked
                    = hidden_field_tag "#{element_id}[page_col_ids][]", page_col.id

- unless !defined?(pages) or pages.empty?
  - pages.each do |page|
    %li
      = link_to page.title, '#'
      - unless page.page_cols.empty?
        %ul
          - page.page_cols.each_with_index do |page_col, index|
            - checked = block.page_cols.include?(page_col)
            %li{:id => "page_col_#{page_col.id}", :class => checked ? 'jstree-checked' : 'jstree-unchecked' }
              = link_to t("page_col_#{index}").capitalize, '#'
              - if checked
                = hidden_field_tag "#{element_id}[page_col_ids][]", page_col.id
