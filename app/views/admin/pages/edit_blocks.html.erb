<%= render :partial => 'top_links', :locals => { :page => @page } %>

<h1>Edit blocks</h1>

<% if @page %>
  <h2>Page <%= @page.title %></h2>

  <h3>
    <%= link_to "Add a block", { :controller => 'admin/blocks', :action => 'create', :page_id => @page.id } %>
  </h3>

  <div id="edit_blocks">
    <table>
      <thead>
        <th>Title</th>
        <th>Other linked pages</th>
        <th>Action</th>
      </thead>

      <% unless @page.blocks.nil? or @page.blocks.blank? %>

        <% @page.blocks.each do |block| %>
        <tr>
          <td><%= link_to block.title, :controller => 'admin/blocks', :action => 'show', :id => block.id %></td>
          <td><%= block.pages.size - 1 %></td>
          <td>
            <%= link_to 'edit', :controller => 'admin/blocks', :action => 'edit', :id => block.id, :page_id => @page.id %>
            -
            <%= link_to 'move up', :action => 'order_blocks', :id => @page.id, :block_id => block.id, :order => 'up' %>
            -
            <%= link_to 'move down', :action => 'order_blocks', :id => @page.id, :block_id => block.id, :order => 'down' %>
            -
            <%= link_to 'unlink', { :action => 'unlink_block', :id => @page.id, :block_id => block.id }, :confirm => 'Are you sure that you want to unlink this block?'%>
            -
            <%= link_to 'delete', { :controller => 'admin/blocks', :action => 'delete', :id => block.id, :page_id => @page.id }, :confirm => 'Are you sure that you want to delete this block? (it will be removed from all its associated pages)' %>
          </td>
        </tr>
        <% end %>

      <% else %>
        <tr> 
 	  <td colspan="3">No blocks</td> 
 	</tr> 
      <% end %>

    </table>
  </div>
<% end %>

<%= link_to 'Back', :back %>
