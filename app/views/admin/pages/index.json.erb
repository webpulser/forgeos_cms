<%
  output = {
    :sEcho => params[:sEcho],
    :iTotalRecords => @pages.total_entries || 0,
    :iTotalDisplayRecords => @pages.size,
    :aaData => @pages.collect do |page|
      # status = [['published', 'published'], ['draft', 'draft'], ['to validate', 'to-validate']]
      status = [[I18n.t('page.published'), 'published'], [I18n.t('page.draft'), 'draft']]

      if params[:mode] && params[:mode].eql?('menu_link')
        [
          content_tag(:div, content_tag(:div, '',:class=>'handler')+content_tag(:div, '', :class=>'small-icons page'), :id => polymorphic_html_id(page), :class => 'handler_container'),
          content_tag(:div, page.title, :class => 'page-name'),
          page.id,
          link_to(page.title, [forgeos_cms, :admin, page])
        ]
      else
        [
          content_tag(:div, content_tag(:div, '', :class=>'handler')+content_tag(:div, '', :class=>'small-icons page'), :id => polymorphic_html_id(page), :class => 'handler_container'),
          content_tag(:div, link_to(page.title, [forgeos_cms, :admin, page]), :class => 'page-name'),
          '',
          '',
          page.updated_at.to_s,
          select_tag(:status, options_for_select(status, page.active ? 'published' : 'draft'), :class => 'customize published', :onchange => "jQuery.ajax({url: '#{forgeos_cms.activate_admin_page_path(page)}', data: { active: this.value }});"),
          link_to('', [forgeos_cms, :duplicate, :admin, page], :class => 'small-icons duplicate-link') +
          link_to('', [forgeos_cms, :edit, :admin, page], :class => 'small-icons edit-link') +
          link_to('', [forgeos_cms, :admin, page],
            :remote => true,
            :method => 'delete',
            :confirm => I18n.t('page.destroy.confirm').capitalize,
            :class => 'small-icons destroy-link',
            :id => polymorphic_html_id(page, 'destroy')
          )
        ]
      end
    end
  }
-%>
<%= raw output.to_json -%>
