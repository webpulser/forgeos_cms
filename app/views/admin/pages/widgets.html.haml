= render :partial => 'top_links', :locals => { :page => @page }
%h1
  = I18n.t('widget.update.action', :count => 2).capitalize
- if @page
  %h2
    = I18n.t('page', :count => 1).capitalize
    = @page.title
  %h3
    = link_to I18n.t('wnew.create.action').capitalize, new_admin_page_widget_wnews_path(@page)
    \ - 
    = link_to I18n.t('carousel.create.action').capitalize, new_admin_page_widget_carousel_path(@page)
  #edit_widgets
    %table#table
      %thead
        %tr
          %th
            = I18n.t('position').capitalize
          %th
            = I18n.t('title').capitalize
          %th
            = I18n.t('type').capitalize
          %th
            = I18n.t('action', :count => 2).capitalize
      %tbody
        - unless @page.widgets.nil? or @page.widgets.blank?
          - @page.widgets.each do |widget|
            %tr{ :class => cycle('even', 'odd') }
              %td
                = widget.position
              %td
                = link_to widget.widgetable.title, admin_widget_wnews_path(widget.widgetable)
              %td
                = widget.widgetable.type
              %td
                = link_to I18n.t('edit').capitalize, ( widget.widgetable.kind_of?(Wnew) ? edit_admin_page_widget_wnews_path(@page, widget.widgetable) : edit_admin_page_widget_carousel_path(@page, widget.widgetable) )
                \-
                = link_to I18n.t('move_up').capitalize, move_up_admin_page_widget_path(@page, widget)
                \-
                = link_to I18n.t('move_down').capitalize, move_down_admin_page_widget_path(@page, widget)
                \-
                = link_to I18n.t('unlink').capitalize, unlink_admin_page_widget_path(@page, widget), :confirm => I18n.t('page.unlink_widget.confirm').capitalize, :method => :delete
                \-
                = link_to I18n.t('delete').capitalize, admin_page_widget_path(@page, widget), :confirm => I18n.t('widget.destroy.confirm_associated').capitalize, :method => :delete
        - else
          %tr
            %td{ :colspan => "3" }
              = I18n.t('widget.none').capitalize
  %br
  %h3
    = I18n.t('existing_widgets').capitalize
  #link_widgets
    %table#table_widgets
      %thead
        %tr
          %th
            = I18n.t('title').capitalize
          %th
            = I18n.t('type').capitalize
          %th
            = I18n.t('linked').capitalize
      %tbody
        -unless @widgets.nil? or @widgets.blank?
          - @widgets.each do |widget|
            %tr
              %td
                = link_to widget.widgetable.title, ( widget.widgetable.type.to_s == 'Wnew' ?  admin_widget_wnews_path(widget) : admin_widget_carousel_path(widget) )
              %td
                = widget.widgetable.type
              %td
                - form_tag :controller => 'admin/widgets', :action => 'link', :id => widget, :page_id => @page.id do |f|
                  = check_box_tag :widget, :link, (widget.linked_with? @page), :onchange => "$(this.form).trigger('submit')"
      - else
        %tr
          %td{ :colspan => "3" }
            = I18n.t('widget.none').capitalize

= dataTables_tag(4,{ :sorting => true })
= dataTables_tag(3,{ :id => 'table_widgets'})
