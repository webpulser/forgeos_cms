- unless defined?(level)
  - level = 0
- categories.each do |category|
  %li
    = link_to category.title, '#', :class=>'big-icons folder'
    - unless category.children.empty? && category.pages.blank?
      %ul
        - category.children.each do |child|
          = render :partial => 'associated_pages', :locals => { :categories => [child], :level => (level + 1), :block => block }
        - category.pages.each do |page|
          %li.page{:id => "page_#{page.id}", :class => block.pages.include?(page) ? 'clicked' : ''}
            = link_to page.title + '<span></span>', '#', :class => "small-icons page"
          - if block.pages.include?(page)
            = hidden_field_tag "static_content_block[page_ids][]", page.id

- unless !defined?(pages) or pages.nil? or pages.blank?
  - pages.each do |page|
    %li.page{:id => "page_#{page.id}", :class => block.pages.include?(page) ? 'clicked' : ''}
      = link_to page.title + '<span></span>', '#', :class => "small-icons page" 
    - if block.pages.include?(page)
      = hidden_field_tag "static_content_block[page_ids][]", page.id
