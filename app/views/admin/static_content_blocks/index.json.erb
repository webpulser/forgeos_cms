{
'iTotalDisplayRecords': <%= @blocks.total_entries || 0 %>,
'aaData': [
<% @blocks.each do |block| %>
  <% 
    link_id = "block_#{block.id}"
    nb_pages = block.pages.count
  %>
  [
  '<%= escape_javascript content_tag(:div, '<div class="image">&nbsp;<span class="small-icons page">&nbsp;</span></div>',:class => 'some-variants plus')%>',
  '<%= escape_javascript content_tag(:div, link_to(block.title, [:admin, block]), :class => 'page-name') %>',
  '<%= escape_javascript "<span class='linked_to'>#{nb_pages.to_s} page"-%>
   <%= escape_javascript "s" if nb_pages>1 -%>
   <%= escape_javascript "</span>" -%>
   <%= escape_javascript link_to('', [:edit, :admin, block], :class => 'small-icons edit-link') -%>
   <%= escape_javascript '<br /><p style="display:none">' -%>
   <% block.pages.each do |page| -%>
     <%= escape_javascript link_to_remote('', :url => {:action => 'unlink',:id => block.id,:page_id => page.id},
      :confirm => I18n.t('page.unlink.confirm').capitalize, 
      :html => {
      :class => 'big-icons big-icons-verti-delete-icon', :id => "destroy_#{link_id}"
    }) -%>
     <%= link_to(page.title, admin_page_path(page.id)) -%><%= "<br />" -%>
   <% end -%>
   <%= link_to('link to a page','', :class => 'small-icons small-icons-verti-small-blue-plus') -%>
   <%= "</p>" %>'
    ] <%= ',' unless @blocks.last == block %>
<% end %>
]
}
