<%
  output = {
    :sEcho => params[:sEcho],
    :iTotalRecords => @widgets.total_entries || 0,
    :iTotalDisplayRecords => @widgets.size,
    :aaData => @widgets.collect do |widget|
      nb_pages = widget.page_cols.count
      [
        content_tag(:div, tag(:div, :class=>'handler')+content_tag(:div, tag(:span, :class=>'small-icons widget'), :class=>'image'), :id => polymorphic_html_id(widget), :class => 'handler_container'),
        content_tag(:div, widget.class.model_name.human.upcase, :class => 'widget-type'),
        content_tag(:div, link_to(widget.title, [forgeos_cms, :edit, :admin, widget]), :class => 'widget-name'),
        content_tag(:span, "#{nb_pages.to_s} #{I18n.t('page', :count => nb_pages)}",  :class => 'linked_to'),
        link_to('', [forgeos_cms, :duplicate, :admin, widget], :class => 'small-icons duplicate-link') +
        link_to('', [forgeos_cms, :edit, :admin, widget], :class => 'small-icons edit-link') +
        link_to('', [forgeos_cms, :admin, widget],
          :remote => true,
          :method => :delete,
          :confirm => I18n.t('widget.destroy.confirm').capitalize,
          :class => 'small-icons destroy-link',
          :id => polymorphic_html_id(widget, 'destroy')
        )
      ]
    end
  }
-%>
<%= raw output.to_json -%>
